<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Shape Recognition</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a1a, #333);
            color: white;
            overflow-x: hidden;
            animation: backgroundShift 5s infinite alternate;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            margin-top: 30px;
            color: cyan;
            text-shadow: 2px 2px 10px black;
            font-size: 2.5em;
            text-align: center;
        }

        .video-container {
            width: 90%;
            max-width: 450px;
            aspect-ratio: 4 / 3;
            border: 3px solid cyan;
            border-radius: 15px;
            margin-top: 20px;
            position: relative;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.7);
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        video, canvas {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 15px;
        }

        .result {
            font-size: 1.5em;
            font-weight: bold;
            padding: 10px;
            display: inline-block;
            border-radius: 10px;
            margin-top: 20px;
            transition: background-color 0.5s ease;
            text-align: center;
        }

        .no-human {
            font-size: 3em;
            color: red;
            font-weight: bold;
            padding: 50px;
            display: inline-block;
            border-radius: 10px;
            background-color: rgba(255, 0, 0, 0.5);
            margin-top: 45px;
            width: 80%;
            text-align: center;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.8);
        }

        .footer {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 14px;
            color: cyan;
        }

        .intro {
            padding: 20px;
            margin: 20px auto;
            width: 80%;
            max-width: 600px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            animation: fadeIn 2s ease-out;
        }

        .section-title {
            font-size: 1.8em;
            color: cyan;
            text-shadow: 1px 1px 5px black;
            margin-bottom: 15px;
        }

        button {
            padding: 12px 25px;
            font-size: 1.2em;
            background-color: cyan;
            color: black;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%;
            max-width: 200px;
            margin-top: 15px;
        }

        button:hover {
            background-color: #00b7b7;
        }

        @keyframes backgroundShift {
            0% { background: linear-gradient(135deg, #1a1a1a, #222); }
            100% { background: linear-gradient(135deg, #333, #444); }
        }

        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            .video-container {
                max-width: 100%;
            }

            .result {
                font-size: 1.2em;
            }

            .no-human {
                font-size: 2.5em;
            }

            .intro, .info {
                width: 90%;
            }

            .footer {
                font-size: 12px;
            }
        }

        .video-container {
            touch-action: none;
        }

    </style>
</head>
<body>
    <h1>Face Shape Recognition</h1>

    <div class="intro">
        <div class="section-title">Welcome to Face Shape Recognition</div>
        <p>This is a beta version of the website, so it may make some mistakes or not be 100% accurate.</p>
        <p>The AI-powered system uses face mesh technology to analyze key facial landmarks, such as the width of your forehead, cheekbones, and jaw, to estimate your face shape. However, results may vary depending on factors such as lighting, angle, or the accuracy of the system's facial landmark detection.</p>
        <button onclick="toggleInfo()">Learn More</button>
    </div>

    <div class="video-container">
        <video id="webcam" autoplay playsinline></video>
        <canvas id="canvas"></canvas>
    </div>

    <div class="result" id="faceShapeResult">Detecting...</div>

    <div class="no-human" id="noHumanMessage" style="display: none;">
        No Human Detected
    </div>

    <div class="info" id="infoSection" style="display: none;">
        <div class="section-title">How Does It Work?</div>
        <p>The face shape is determined based on various landmarks that represent key points on the face. These landmarks are used to calculate facial dimensions and ratios such as forehead width, cheekbone width, jaw width, and face height. The system then classifies the face into one of several shapes:</p>
        <ul>
            <li><strong>Oval:</strong> A balanced face with slightly longer length than width.</li>
            <li><strong>Round:</strong> A face with a rounded jawline and equal width and height.</li>
            <li><strong>Square:</strong> A face with strong, angular features and equal width across forehead, cheekbones, and jawline.</li>
            <li><strong>Diamond:</strong> A face with high cheekbones and a narrow jawline.</li>
            <li><strong>Heart:</strong> A face with a wide forehead and narrow chin.</li>
            <li><strong>Pear:</strong> A face with a narrow forehead and wider jawline.</li>
            <li><strong>Oblong:</strong> A longer face shape with a narrow width.</li>
            <li><strong>Inverted Triangle:</strong> A face shape with a narrow chin and wider forehead, similar to the heart shape but more pointed.</li>
            <li><strong>Triangle:</strong> A face with a wide jawline and narrow forehead.</li>
        </ul>
    </div>

    <div class="footer">Website by Prem Patel</div>

    <script>
        let video = document.getElementById('webcam');
        let canvas = document.getElementById('canvas');
        let ctx = canvas.getContext('2d');
        let resultText = document.getElementById('faceShapeResult');
        let noHumanMessage = document.getElementById('noHumanMessage');
        let faceMesh;
        let infoSection = document.getElementById('infoSection');

        async function startWebcam() {
            try {
                let stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                video.srcObject = stream;
                return new Promise(resolve => {
                    video.onloadedmetadata = () => {
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        resolve();
                    };
                });
            } catch (error) {
                console.error("Error accessing webcam:", error);
            }
        }

        async function loadFaceMesh() {
            faceMesh = new FaceMesh({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}` });
            faceMesh.setOptions({ maxNumFaces: 1, refineLandmarks: true, minDetectionConfidence: 0.9, minTrackingConfidence: 0.9 });
            faceMesh.onResults(processResults);
        }

        async function detectFace() {
            if (!faceMesh) return;
            await faceMesh.send({ image: video });
            requestAnimationFrame(detectFace);
        }

        function processResults(results) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            if (!results.multiFaceLandmarks || results.multiFaceLandmarks.length === 0) {
                noHumanMessage.style.display = 'block';
                resultText.style.display = 'none';
                return;
            } else {
                noHumanMessage.style.display = 'none';
                resultText.style.display = 'block';
            }

            let faceShape = classifyFaceShape(results.multiFaceLandmarks[0]);
            resultText.innerText = `Face Shape: ${faceShape}`;
            applyColor(faceShape);
            drawLandmarks(results.multiFaceLandmarks[0]);
        }

        function classifyFaceShape(landmarks) {
            let foreheadWidth = Math.abs(landmarks[10].x - landmarks[338].x);
            let cheekboneWidth = Math.abs(landmarks[234].x - landmarks[454].x);
            let jawWidth = Math.abs(landmarks[152].x - landmarks[175].x);
            let faceHeight = Math.abs(landmarks[10].y - landmarks[152].y);
            let aspectRatio = cheekboneWidth / faceHeight;

            if (aspectRatio > 1.4) return "Oval";
            if (jawWidth > cheekboneWidth * 1.15) return "Square";
            if (cheekboneWidth > foreheadWidth * 1.3) return "Heart";
            if (aspectRatio < 0.95) return "Round";
            if (faceHeight > foreheadWidth * 1.5) return "Oblong";
            if (jawWidth > cheekboneWidth && cheekboneWidth > foreheadWidth) return "Diamond";
            if (jawWidth > foreheadWidth * 1.2) return "Pear";
            if (cheekboneWidth > foreheadWidth * 1.2 && jawWidth > foreheadWidth * 1.2) return "Inverted Triangle";
            if (jawWidth > cheekboneWidth * 1.2) return "Triangle";
            return "Unknown";
        }

        function applyColor(shape) {
            const colors = {
                "Oval": "lightblue",
                "Round": "pink",
                "Square": "orange",
                "Diamond": "purple",
                "Heart": "red",
                "Pear": "brown",
                "Oblong": "yellow",
                "Inverted Triangle": "lightgreen",
                "Triangle": "lightcoral",
                "Unknown": "gray"
            };
            resultText.style.backgroundColor = colors[shape] || "gray";
        }

        function drawLandmarks(landmarks) {
            ctx.strokeStyle = "cyan";
            ctx.lineWidth = 2;
            for (let i = 0; i < landmarks.length; i++) {
                let x = landmarks[i].x * canvas.width;
                let y = landmarks[i].y * canvas.height;
                ctx.beginPath();
                ctx.arc(x, y, 2, 0, 2 * Math.PI);
                ctx.fillStyle = "red";
                ctx.fill();
            }
        }

        async function run() {
            await startWebcam();
            await loadFaceMesh();
            detectFace();
        }

        run();

        function toggleInfo() {
            infoSection.style.display = infoSection.style.display === "none" ? "block" : "none";
        }
    </script>
</body>
</html>
